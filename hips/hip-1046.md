# HIP-1046: Dynamic gRPC-Web Proxies

HIP: https://hips.hedera.com/hip/hip-1046

Protobuf PR: https://github.com/hiero-ledger/hiero-consensus-node/pull/18766

This HIP introduces new grpc web proxy field in the address book schema, making node operators manage their web proxies. These web proxy addresses will be available in the `AddressBookQuery` making JS/TS clients to dynamically determine the appropriate endpoints.

## Updated APIs

### NodeCreateTransaction

- `Endpoint grpcWebProxyEndpoint`  - A web proxy for gRPC from non-gRPC clients.
    - `Endpoint getGrpcWebProxyEndpoint()`
    - `NodeCreateTransaction setGrpcWebProxyEndpoint(Endpoint)`

### NodeUpdateTransaction

- `Endpoint grpcWebProxyEndpoint`  - A web proxy for gRPC from non-gRPC clients.
    - `Endpoint getGrpcWebProxyEndpoint()`
    - `NodeUpdateTransaction setGrpcWebProxyEndpoint(Endpoint)`

### AddressBookQuery

Not yet specified

Currently the AddressBookQuery returns a list of `NodeAddress` The `NodeAddress` looks like this:

```go
NodeAddress {
	PublicKey   string
	AccountID   AccountID
	NodeID      int64
	CertHash    []byte
	Addresses   []Endpoint
	Description string
}
```

Each node has a list of `Endpoint` where I’m guessing the grpc data will be returned. We only need to determine if it’s grpc endpoint or web proxy endpoint. This could be achieved with enum defined in the protobufs, but we don’t have the mirror node spec yet.

JS SDK would need to filter the web proxy/grpc endpoints from the address book, depending on the environment.

Other SDKs need to ignore the web proxy endpoints and continue to work with gRPC endpoints.

### JS SDK Specific changes

`Client.updateNetwork | forMirrorNetwork` Need to be supported for browser env.

---

## Test Plan

1. Executes `NodeCreateTransaction` with grpc web proxy endpoint set successfully and validates it’s presence using `AddressBookQuery`.
2. Given a node with missing grpc web proxy endpoint, executes `NodeUpdateTransaction` in order to populate it successfully and validates it’s presence using `AddressBookQuery`.
3.  Given a node with existing grpc web proxy endpoint, executes `NodeUpdateTransaction` in order to populate it successfully and validates it’s presence using `AddressBookQuery`.
4. Given a node with missing grpc web proxy endpoint, executes `NodeUpdateTransaction` without specifying grpc web proxy and and validates it’s not present using `AddressBookQuery`.
5. Given a node with existing grpc web proxy endpoint, executes `NodeUpdateTransaction` without specifying grpc web proxy and and validates it’s unchanged using `AddressBookQuery`.

## Example

1. **Create a Node with gRPC Web Proxy Endpoint**
2. **Update a Node with a New gRPC Web Proxy Endpoint**
3. **Query Address Book and Read gRPC Web Proxy Endpoints**